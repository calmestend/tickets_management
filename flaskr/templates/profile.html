<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Editar Perfil - UTC</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: Arial, sans-serif;
			background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
			min-height: 100vh;
			padding: 20px;
		}

		.container {
			max-width: 600px;
			margin: 0 auto;
			background: white;
			border-radius: 12px;
			padding: 30px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
		}

		h1 {
			color: #2c7a7b;
			text-align: center;
			margin-bottom: 30px;
			font-size: 24px;
		}

		.form-group {
			margin-bottom: 20px;
		}

		label {
			display: block;
			color: #2c7a7b;
			font-weight: bold;
			margin-bottom: 5px;
		}

		input,
		select,
		textarea {
			width: 100%;
			padding: 12px;
			border: 2px solid #e2e8f0;
			border-radius: 8px;
			font-size: 16px;
			transition: border-color 0.3s;
		}

		input:focus,
		select:focus,
		textarea:focus {
			outline: none;
			border-color: #4fd1c7;
		}

		textarea {
			height: 80px;
			resize: vertical;
		}

		.buttons {
			display: flex;
			gap: 15px;
			justify-content: center;
			margin-top: 30px;
		}

		button {
			padding: 12px 30px;
			border: none;
			border-radius: 25px;
			font-size: 16px;
			font-weight: bold;
			cursor: pointer;
			transition: all 0.3s;
		}

		.save-btn {
			background: linear-gradient(135deg, #2c7a7b 0%, #4fd1c7 100%);
			color: white;
		}

		.cancel-btn {
			background: #e2e8f0;
			color: #666;
		}

		button:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
		}

		.avatar-section {
			text-align: center;
			margin-bottom: 30px;
		}

		.avatar {
			width: 80px;
			height: 80px;
			border-radius: 50%;
			background: linear-gradient(135deg, #2c7a7b 0%, #4fd1c7 100%);
			display: inline-flex;
			align-items: center;
			justify-content: center;
			color: white;
			font-size: 32px;
			font-weight: bold;
			margin-bottom: 10px;
		}
	</style>
</head>

<body>
	<div class="container">
		<h1>‚úèÔ∏è Editar Mi Perfil</h1>

		<div class="avatar-section">
			<div class="avatar">{{ user.initials }}</div>
			<p style="color: #666; font-size: 14px;">Avatar actual</p>
		</div>

		<form id="profile-form">
			<div class="form-group">
				<label>Nombre Completo</label>
				<input type="text" name="name" id="name" value="{{ user.name }}" required>
			</div>

			<div class="form-group">
				<label>Apellido</label>
				<input type="text" name="last_name" id="last_name" value="{{ user.last_name }}" required>
			</div>

			<div class="form-group">
				<label>Email</label>
				<input type="email" name="email" id="email" value="{{ user.email }}" required>
			</div>

			<div class="form-group">
				<label>√Årea</label>
				<select name="study_area" id="study_area">
					<option {% if user.study_area=='Ingenier√≠a en Sistemas' %}selected{% endif %}>Ingenier√≠a en Sistemas</option>
					<option {% if user.study_area=='Ingenier√≠a Industrial' %}selected{% endif %}>Ingenier√≠a Industrial</option>
					<option {% if user.study_area=='Administraci√≥n' %}selected{% endif %}>Administraci√≥n</option>
					<option {% if user.study_area=='Contabilidad' %}selected{% endif %}>Contabilidad</option>
				</select>
			</div>

			<div class="form-group">
				<label>Semestre</label>
				<select name="term" id="term">
					{% for i in range(1, 10) %}
					<option value="{{ i }}" {% if user.term==i %}selected{% endif %}>{{ i }}¬∞ Semestre</option>
					{% endfor %}
				</select>
			</div>

			<div class="form-group">
				<label>Especialidad</label>
				<input type="text" name="study_speciality" id="study_speciality" value="{{ user.study_speciality }}">
			</div>

			<div class="form-group">
				<label>Descripci√≥n Personal</label>
				<textarea name="personal_description" id="personal_description">{{ user.personal_description }}</textarea>
			</div>

			<div class="buttons">
				<button type="button" class="cancel-btn" onclick="history.back()">Cancelar</button>
				<button type="submit" class="save-btn">üíæ Guardar Cambios</button>
			</div>
		</form>

	</div>

	<script>
		document.getElementById('profile-form').addEventListener('submit', async function (e) {
			e.preventDefault();

			const data = {
				name: document.getElementById('name').value.trim(),
				last_name: document.getElementById('last_name').value.trim(),
				email: document.getElementById('email').value.trim(),
				study_area: document.getElementById('study_area').value,
				study_speciality: document.getElementById('study_speciality').value.trim(),
				term: parseInt(document.getElementById('term').value),
				personal_description: document.getElementById('personal_description').value.trim()
			};

			try {
				const res = await fetch('/profile', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(data)
				});
				const result = await res.json();

				if (result.success) {
					alert(result.message);
					location.reload();
				} else {
					alert('Error: ' + result.message);
				}
			} catch (err) {
				console.error(err);
				alert('Error al enviar datos');
			}
		});
	</script>

</body>

</html>

<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Tu Voz Importa - UTC</title>
	<style>
		:root {
			--primary-color: #17A67D;
			--secondary-color: #0D0D0D;
			--accent-color: #F2F2F2;
			--text-color: #333333;
			--highlight-color: #0FBBC9;
		}

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			margin: 0;
			padding: 0;
			background-color: var(--accent-color);
			color: var(--text-color);
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
			padding: 20px;
		}

		header {
			background-color: var(--primary-color);
			color: white;
			padding: 20px 0;
			text-align: center;
			border-radius: 0 0 10px 10px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
		}

		h1 {
			margin: 0;
			font-size: 2.2rem;
		}

		.subtitle {
			font-style: italic;
			margin-top: 5px;
		}

		.nav-section {
			display: flex;
			justify-content: space-between;
			align-items: center;
			flex-wrap: wrap;
			gap: 10px;
			margin: 20px 0;
		}

		.login-btn {
			background-color: var(--highlight-color);
			color: white;
			padding: 10px 20px;
			border-radius: 25px;
			text-decoration: none;
			font-weight: bold;
			transition: all 0.3s ease;
			border: none;
			cursor: pointer;
		}

		.login-btn:hover {
			background-color: var(--primary-color);
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
		}

		.login-btn.primary {
			background-color: var(--primary-color);
		}

		.login-btn.secondary {
			background-color: var(--secondary-color);
		}

		.login-btn.logout {
			background-color: #dc3545;
		}

		.login-btn.logout:hover {
			background-color: #c82333;
		}

		.ticket-container {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
			gap: 20px;
			margin-top: 30px;
		}

		.ticket-card {
			background-color: white;
			border-radius: 8px;
			padding: 20px;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			transition: transform 0.3s ease;
		}

		.ticket-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
		}

		.ticket-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 15px;
			padding-bottom: 10px;
			border-bottom: 1px solid #eee;
		}

		.ticket-category {
			background-color: var(--primary-color);
			color: white;
			padding: 5px 10px;
			border-radius: 20px;
			font-size: 0.8rem;
			font-weight: bold;
		}

		.ticket-date {
			color: #666;
			font-size: 0.9rem;
		}

		.ticket-title {
			font-weight: bold;
			margin-bottom: 10px;
			color: var(--secondary-color);
			font-size: 1.1rem;
		}

		.ticket-content {
			margin-bottom: 15px;
			line-height: 1.5;
		}

		.ticket-status {
			display: inline-block;
			padding: 3px 10px;
			border-radius: 20px;
			font-size: 0.8rem;
			font-weight: bold;
		}

		.status-pendiente {
			background-color: #FFF3CD;
			color: #856404;
		}

		.status-en-proceso {
			background-color: #D1ECF1;
			color: #0C5460;
		}

		.status-resuelto {
			background-color: #D4EDDA;
			color: #155724;
		}

		.status-escalado {
			background-color: #F8D7DA;
			color: #721C24;
		}

		.filter-section {
			background-color: white;
			padding: 15px;
			border-radius: 8px;
			margin-bottom: 20px;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		}

		.filter-options {
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
		}

		.filter-btn {
			background-color: var(--accent-color);
			border: 1px solid #ddd;
			padding: 8px 15px;
			border-radius: 20px;
			cursor: pointer;
			transition: all 0.3s ease;
		}

		.filter-btn:hover,
		.filter-btn.active {
			background-color: var(--primary-color);
			color: white;
			border-color: var(--primary-color);
		}

		.no-tickets {
			text-align: center;
			padding: 40px;
			color: #666;
			font-style: italic;
			grid-column: 1 / -1;
		}

		.user-info {
			background-color: white;
			padding: 10px 15px;
			border-radius: 20px;
			display: flex;
			align-items: center;
			gap: 10px;
			font-size: 0.9rem;
		}

		.user-avatar {
			background-color: var(--primary-color);
			color: white;
			width: 30px;
			height: 30px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: bold;
			font-size: 0.8rem;
		}

		@media (max-width: 768px) {
			.nav-section {
				flex-direction: column;
				align-items: stretch;
			}

			.login-btn {
				text-align: center;
			}
		}
	</style>
</head>

<body>
	<header>
		<div class="container">
			<h1>¡Tu voz importa!</h1>
			<p class="subtitle">Comparte tus opiniones, quejas y sugerencias para mejorar nuestra universidad</p>
		</div>
	</header>

	<div class="container">
		<div class="nav-section" id="navigation">
			<!-- El contenido se cargará dinámicamente -->
		</div>
	</div>

	<main class="container">
		<div class="filter-section">
			<h3>Filtrar por categoría:</h3>
			<div class="filter-options">
				<button class="filter-btn active" data-filter="todos">Todos</button>
				<button class="filter-btn" data-filter="servicios-academicos">Servicios Académicos</button>
				<button class="filter-btn" data-filter="infraestructura">Infraestructura</button>
				<button class="filter-btn" data-filter="cafeteria">Cafetería</button>
				<button class="filter-btn" data-filter="biblioteca">Biblioteca</button>
				<button class="filter-btn" data-filter="tecnologia">Tecnología</button>
				<button class="filter-btn" data-filter="administrativo">Administrativo</button>
				<button class="filter-btn" data-filter="servicios-estudiantiles">Servicios Estudiantiles</button>
			</div>
		</div>

		<div class="ticket-container" id="ticketsContainer">
			<div class="no-tickets">
				<p>Cargando tickets...</p>
			</div>
		</div>
	</main>

	<script>
		let allTickets = [];
		let currentFilter = 'todos';

		// Verificar sesión al cargar
		document.addEventListener('DOMContentLoaded', function () {
			checkSession();
			loadTickets();
		});

		async function checkSession() {
			try {
				const response = await fetch('/check-session');
				const data = await response.json();

				const navigation = document.getElementById('navigation');

				if (data.authenticated) {
					navigation.innerHTML = `
		<div class="user-info">
			<div class="user-avatar">
				${data.user.name[0]}${data.user.name.split(' ')[1] ? data.user.name.split(' ')[1][0] : ''}
			</div>
			<span>Hola, ${data.user.name}</span>
		</div>
		<div style="display: flex; gap: 10px; flex-wrap: wrap;">
			${data.user.role === 'admin' ? '<a href="/ticket" class="login-btn primary">Validar Tickets</a>' : '<a href="/post" class="login-btn primary">Nueva queja/sugerencia</a>'}
			${data.user.role === 'admin' ? '' : '<a href="/profile" class="login-btn">Mi Perfil</a>'}
			${data.user.role === 'admin' ? '<a href="/admin-dashboard" class="login-btn">Panel Admin</a>' : ''}
			<a href="/logout" class="login-btn logout">Cerrar Sesión</a>
		</div>
	`;
				} else {
					navigation.innerHTML = `
		<div style="display: flex; gap: 10px; flex-wrap: wrap; width: 100%; justify-content: center;">
			<a href="/auth" class="login-btn primary">Iniciar Sesión</a>
		</div>
	`;
				}

			} catch (error) {
				console.error('Error checking session:', error);
				// Mostrar opciones de invitado
				const navigation = document.getElementById('navigation');
				navigation.innerHTML = `
					<div style="display: flex; gap: 10px; flex-wrap: wrap; width: 100%; justify-content: center;">
						<a href="/auth" class="login-btn primary">Iniciar Sesión</a>
					</div>
				`;
			}
		}

		async function loadTickets() {
			try {
				// Simulamos carga de tickets - en implementación real vendría del backend
				const sampleTickets = [
					{
						id: 1,
						category: 'cafeteria',
						categoryName: 'Cafetería',
						date: '2025-07-25',
						title: 'Falta de variedad en el menú',
						content: 'Desde hace varias semanas noto que las opciones en la cafetería principal son muy limitadas y se repiten constantemente. Sería bueno tener más variedad de alimentos saludables.',
						status: 'en-proceso'
					},
					{
						id: 2,
						category: 'infraestructura',
						categoryName: 'Infraestructura',
						date: '2025-07-24',
						title: 'Aire acondicionado en aula B-203',
						content: 'El aire acondicionado del aula B-203 no funciona correctamente, hace mucho calor durante las clases de la tarde.',
						status: 'pendiente'
					},
					{
						id: 3,
						category: 'servicios-academicos',
						categoryName: 'Servicios Académicos',
						date: '2025-07-23',
						title: 'Problema con inscripción a materias',
						content: 'No he podido inscribirme a las materias optativas del semestre debido a problemas técnicos en el sistema.',
						status: 'resuelto'
					},
					{
						id: 4,
						category: 'biblioteca',
						categoryName: 'Biblioteca',
						date: '2025-07-22',
						title: 'Horarios de biblioteca',
						content: 'Sugiero extender los horarios de la biblioteca durante época de exámenes finales.',
						status: 'pendiente'
					},
					{
						id: 5,
						category: 'tecnologia',
						categoryName: 'Tecnología',
						date: '2025-07-21',
						title: 'WiFi lento en laboratorios',
						content: 'La conexión a internet en los laboratorios de computación es muy lenta, afecta las clases prácticas.',
						status: 'escalado'
					}
				];

				allTickets = sampleTickets;
				displayTickets(allTickets);
			} catch (error) {
				console.error('Error loading tickets:', error);
				document.getElementById('ticketsContainer').innerHTML = `
					<div class="no-tickets">
						<p>Error al cargar los tickets. Inténtalo de nuevo más tarde.</p>
					</div>
				`;
			}
		}

		function displayTickets(tickets) {
			const container = document.getElementById('ticketsContainer');

			if (tickets.length === 0) {
				container.innerHTML = `
					<div class="no-tickets">
						<p>No hay tickets para mostrar${currentFilter !== 'todos' ? ' en esta categoría' : ''}.</p>
					</div>
				`;
				return;
			}

			container.innerHTML = tickets.map(ticket => `
				<div class="ticket-card">
					<div class="ticket-header">
						<span class="ticket-category">${ticket.categoryName}</span>
						<span class="ticket-date">${formatDate(ticket.date)}</span>
					</div>
					<h3 class="ticket-title">${ticket.title}</h3>
					<p class="ticket-content">${ticket.content}</p>
					<span class="ticket-status status-${ticket.status}">${getStatusText(ticket.status)}</span>
				</div>
			`).join('');
		}

		function formatDate(dateString) {
			const date = new Date(dateString);
			return date.toLocaleDateString('es-ES', {
				day: '2-digit',
				month: '2-digit',
				year: 'numeric'
			});
		}

		function getStatusText(status) {
			const statusMap = {
				'pendiente': 'Pendiente',
				'en-proceso': 'En progreso',
				'resuelto': 'Resuelto',
				'escalado': 'Escalado'
			};
			return statusMap[status] || status;
		}

		function filterTickets(category) {
			currentFilter = category;

			if (category === 'todos') {
				displayTickets(allTickets);
			} else {
				const filtered = allTickets.filter(ticket => ticket.category === category);
				displayTickets(filtered);
			}
		}

		// Event listeners para filtros
		document.querySelectorAll('.filter-btn').forEach(btn => {
			btn.addEventListener('click', () => {
				document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
				btn.classList.add('active');

				const filter = btn.getAttribute('data-filter');
				filterTickets(filter);
			});
		});
	</script>
</body>

</html>

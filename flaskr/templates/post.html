<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Nueva Queja o Sugerencia - UTC</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background: linear-gradient(135deg, #f0f9ff 0%, #c6f6d5 100%);
			min-height: 100vh;
			color: #1a202c;
			padding: 20px;
		}

		.header {
			background: white;
			padding: 15px 30px;
			border-radius: 12px;
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 30px;
		}

		.nav-links {
			display: flex;
			gap: 15px;
		}

		.nav-links a {
			color: #38a169;
			text-decoration: none;
			font-weight: 500;
			padding: 8px 15px;
			border-radius: 8px;
			transition: all 0.3s ease;
		}

		.nav-links a:hover {
			background-color: #38a169;
			color: white;
		}

		.container {
			max-width: 700px;
			margin: 0 auto;
			background: white;
			border-radius: 15px;
			box-shadow: 0 6px 30px rgba(0, 0, 0, 0.1);
			overflow: hidden;
		}

		.form-header {
			background: linear-gradient(135deg, #38a169 0%, #48bb78 100%);
			color: white;
			padding: 30px;
			text-align: center;
		}

		.form-header h1 {
			font-size: 28px;
			margin-bottom: 10px;
			font-weight: 300;
		}

		.form-header p {
			opacity: 0.9;
			font-size: 16px;
		}

		.form-content {
			padding: 40px;
		}

		.form-section {
			margin-bottom: 30px;
			padding: 25px;
			border: 1px solid #e2e8f0;
			border-radius: 12px;
			background: #f7fafc;
		}

		.section-title {
			color: #2d3748;
			font-size: 18px;
			font-weight: 600;
			margin-bottom: 20px;
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.form-group {
			margin-bottom: 20px;
		}

		.form-row {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 20px;
		}

		label {
			display: block;
			margin-bottom: 8px;
			color: #2d3748;
			font-weight: 600;
			font-size: 14px;
		}

		.required {
			color: #e53e3e;
		}

		input[type="text"],
		input[type="email"],
		input[type="date"],
		select,
		textarea {
			width: 100%;
			padding: 12px 15px;
			border: 2px solid #e2e8f0;
			border-radius: 8px;
			font-size: 14px;
			font-family: inherit;
			transition: all 0.3s ease;
			background: white;
		}

		input:focus,
		select:focus,
		textarea:focus {
			outline: none;
			border-color: #38a169;
			box-shadow: 0 0 0 3px rgba(56, 161, 105, 0.1);
		}

		textarea {
			resize: vertical;
			min-height: 120px;
			line-height: 1.5;
		}

		.description-area {
			background: #f0fff4;
			border: 2px solid #38a169;
			min-height: 150px;
		}

		.priority-select,
		.category-select {
			background: #f0fff4;
			border: 2px solid #38a169;
		}

		.char-counter {
			text-align: right;
			font-size: 12px;
			color: #718096;
			margin-top: 5px;
		}

		.action-buttons {
			display: flex;
			gap: 15px;
			justify-content: center;
			margin-top: 30px;
			flex-wrap: wrap;
		}

		.btn {
			padding: 15px 30px;
			border: none;
			border-radius: 25px;
			cursor: pointer;
			font-size: 16px;
			font-weight: 600;
			transition: all 0.3s ease;
			display: flex;
			align-items: center;
			gap: 10px;
			min-width: 160px;
			justify-content: center;
		}

		.btn-primary {
			background: linear-gradient(135deg, #38a169 0%, #48bb78 100%);
			color: white;
		}

		.btn-primary:hover:not(:disabled) {
			transform: translateY(-2px);
			box-shadow: 0 4px 15px rgba(56, 161, 105, 0.3);
		}

		.btn-primary:disabled {
			background: #cbd5e0;
			cursor: not-allowed;
			transform: none;
		}

		.btn-secondary {
			background: #e2e8f0;
			color: #4a5568;
		}

		.btn-secondary:hover {
			background: #cbd5e0;
			transform: translateY(-2px);
		}

		.notification {
			position: fixed;
			top: 20px;
			right: 20px;
			padding: 15px 25px;
			border-radius: 8px;
			color: white;
			font-weight: 500;
			z-index: 1000;
			transform: translateX(400px);
			transition: transform 0.3s ease;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
			max-width: 350px;
		}

		.notification.show {
			transform: translateX(0);
		}

		.notification.success {
			background: #38a169;
		}

		.notification.error {
			background: #e53e3e;
		}

		.notification.info {
			background: #3182ce;
		}

		.help-text {
			font-size: 12px;
			color: #718096;
			margin-top: 5px;
			font-style: italic;
		}

		.readonly-field {
			background: #f7fafc !important;
			cursor: not-allowed !important;
			color: #4a5568;
		}

		@media (max-width: 768px) {
			.form-row {
				grid-template-columns: 1fr;
			}

			.action-buttons {
				flex-direction: column;
				align-items: center;
			}

			.btn {
				width: 100%;
				max-width: 300px;
			}

			.form-content {
				padding: 20px;
			}

			.header {
				flex-direction: column;
				gap: 15px;
				text-align: center;
			}
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="form-header">
			<h1>Nueva Queja o Sugerencia</h1>
			<p>Tu opini√≥n es importante para mejorar nuestra universidad</p>
		</div>

		<div class="form-content">
			<form id="complaintForm">
				<!-- Informaci√≥n Personal -->
				<div class="form-section">
					<h3 class="section-title">
						üë§ Informaci√≥n Personal
					</h3>

					<div class="form-row">
						<div class="form-group">
							<label for="studentName">Nombre Completo <span class="required">*</span></label>
							<input type="text" id="studentName" value="{{ user.full_name }}" readonly class="readonly-field">
						</div>
						<div class="form-group">
							<label for="studentEmail">Email Institucional <span class="required">*</span></label>
							<input type="email" id="studentEmail" value="{{ user.email }}" readonly class="readonly-field">
						</div>
					</div>

					<div class="form-row">
						<div class="form-group">
							<label for="carrera">Carrera</label>
							<input type="text" id="carrera" value="{{ user.study_area }}" readonly class="readonly-field">
						</div>
						<div class="form-group">
							<label for="semestre">Semestre</label>
							<input type="text" id="semestre" value="{{ user.term }}¬∫ Semestre" readonly class="readonly-field">
						</div>
					</div>
				</div>

				<!-- Detalles de la Queja/Sugerencia -->
				<div class="form-section">
					<h3 class="section-title">
						üìã Detalles de tu Solicitud
					</h3>

					<div class="form-row">
						<div class="form-group">
							<label for="type">Tipo de Solicitud <span class="required">*</span></label>
							<select id="type" name="type" class="category-select" required>
								<option value="">Seleccionar tipo...</option>
								<option value="queja">üî¥ Queja</option>
								<option value="sugerencia">üí° Sugerencia</option>
								<option value="peticion">üìû Petici√≥n</option>
							</select>
						</div>
						<div class="form-group">
							<label for="category">Categor√≠a <span class="required">*</span></label>
							<select id="category" name="category" class="category-select" required>
								<option value="">Seleccionar categor√≠a...</option>
								<option value="servicios-academicos">üìö Servicios Acad√©micos</option>
								<option value="infraestructura">üè¢ Infraestructura</option>
								<option value="servicios-estudiantiles">üéì Servicios Estudiantiles</option>
								<option value="tecnologia">üíª Tecnolog√≠a</option>
								<option value="administrativo">üìÑ Administrativo</option>
								<option value="biblioteca">üìñ Biblioteca</option>
								<option value="cafeteria">üçΩÔ∏è Cafeter√≠a</option>
								<option value="otro">üîß Otro</option>
							</select>
						</div>
					</div>

					<div class="form-row">
						<div class="form-group">
							<label for="priority">Prioridad <span class="required">*</span></label>
							<select id="priority" name="priority" class="priority-select" required>
								<option value="">Seleccionar prioridad...</option>
								<option value="alta">üî¥ Alta - Urgente</option>
								<option value="media">üü° Media - Importante</option>
								<option value="baja">üü¢ Baja - Cuando sea posible</option>
							</select>
						</div>
						<div class="form-group">
							<label for="incident_date">Fecha del Incidente</label>
							<input type="date" id="incident_date" name="incident_date">
							<div class="help-text">Opcional: Fecha en que ocurri√≥ el problema</div>
						</div>
					</div>

					<div class="form-group">
						<label for="subject">Asunto <span class="required">*</span></label>
						<input type="text" id="subject" name="subject" placeholder="Resumen breve de tu solicitud" maxlength="100"
							required>
						<div class="char-counter">
							<span id="subjectCounter">0</span>/100 caracteres
						</div>
					</div>

					<div class="form-group">
						<label for="description">Descripci√≥n Detallada <span class="required">*</span></label>
						<textarea id="description" name="description" class="description-area"
							placeholder="Describe detalladamente tu queja, sugerencia o petici√≥n. Incluye todos los detalles relevantes..."
							maxlength="1000" required></textarea>
						<div class="char-counter">
							<span id="descriptionCounter">0</span>/1000 caracteres
						</div>
						<div class="help-text">S√© espec√≠fico: ¬øqu√© pas√≥?, ¬øcu√°ndo?, ¬ød√≥nde?, ¬øqui√©n estuvo involucrado?</div>
					</div>
				</div>

				<div class="action-buttons">
					<button type="button" class="btn btn-secondary" onclick="window.history.back()">
						‚Ü™Ô∏è Cancelar
					</button>
					<button type="submit" class="btn btn-primary" id="submitBtn">
						üì§ Enviar Solicitud
					</button>
				</div>
			</form>
		</div>
	</div>

	<div id="notification" class="notification"></div>

	<script>
		// Contadores de caracteres
		function setupCharCounters() {
			const fields = [
				{input: 'subject', counter: 'subjectCounter', max: 100},
				{input: 'description', counter: 'descriptionCounter', max: 1000}
			];

			fields.forEach(field => {
				const input = document.getElementById(field.input);
				const counter = document.getElementById(field.counter);

				if (input && counter) {
					input.addEventListener('input', function () {
						const count = this.value.length;
						counter.textContent = count;

						if (count > field.max * 0.9) {
							counter.style.color = '#e53e3e';
						} else {
							counter.style.color = '#718096';
						}
					});
				}
			});
		}

		// Funci√≥n para mostrar notificaciones
		function showNotification(message, type = 'success') {
			const notification = document.getElementById('notification');
			notification.textContent = message;
			notification.className = `notification ${type} show`;

			setTimeout(() => {
				notification.classList.remove('show');
			}, 5000);
		}

		// Manejar env√≠o del formulario
		document.getElementById('complaintForm').addEventListener('submit', async function (e) {
			e.preventDefault();

			const submitBtn = document.getElementById('submitBtn');

			// Deshabilitar bot√≥n
			submitBtn.disabled = true;
			submitBtn.innerHTML = '‚è≥ Enviando...';

			// Obtener datos del formulario
			const formData = new FormData(this);
			const complaintData = {
				type: formData.get('type'),
				category: formData.get('category'),
				priority: formData.get('priority'),
				subject: formData.get('subject'),
				description: formData.get('description'),
				incident_date: formData.get('incident_date')
			};

			// Validar campos requeridos
			const requiredFields = ['type', 'category', 'priority', 'subject', 'description'];
			let isValid = true;

			requiredFields.forEach(fieldName => {
				const field = document.getElementById(fieldName);
				if (!complaintData[fieldName] || !complaintData[fieldName].trim()) {
					field.style.borderColor = '#e53e3e';
					isValid = false;
				} else {
					field.style.borderColor = '#e2e8f0';
				}
			});

			if (!isValid) {
				showNotification('Por favor completa todos los campos requeridos', 'error');
				submitBtn.disabled = false;
				submitBtn.innerHTML = 'üì§ Enviar Solicitud';
				return;
			}

			try {
				const response = await fetch('/post', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify(complaintData)
				});

				const result = await response.json();

				if (result.success) {
					showNotification(result.message, 'success');

					// Limpiar formulario despu√©s de un delay
					setTimeout(() => {
						this.reset();
						setupCharCounters();
						// Redirigir al inicio
						window.location.href = '/';
					}, 2000);
				} else {
					showNotification(result.message, 'error');
					if (result.errors) {
						result.errors.forEach(error => {
							console.error('Error de validaci√≥n:', error);
						});
					}
				}
			} catch (error) {
				console.error('Error:', error);
				showNotification('Error de conexi√≥n. Int√©ntalo de nuevo.', 'error');
			}

			// Habilitar bot√≥n nuevamente
			submitBtn.disabled = false;
			submitBtn.innerHTML = 'üì§ Enviar Solicitud';
		});

		// Inicializar contadores al cargar la p√°gina
		document.addEventListener('DOMContentLoaded', function () {
			setupCharCounters();
		});
	</script>
</body>

</html>
